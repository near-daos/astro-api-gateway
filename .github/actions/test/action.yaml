name: 'Run Tests'
inputs:
  environment:
    description: Environment to run on. Valid choices are dev, testnet
    default: develop
    required: true
  NEAR_ACCOUNT_ID:
    required: true
  NEAR_PUBLIC_KEY:
    required: true
  NEAR_PRIVATE_KEY:
    required: true

runs:
  using: 'docker'
  image: public.ecr.aws/c2q4e2i6/jdk-near-cli:latest
  entrypoint: /bin/bash
  args:
  - -c
  - | 
    cd /github/workspace/test-framework
    cat <<- EOF > $HOME/.near-credentials/testnet/${NEAR_ACCOUNT_ID}.json
      {
        "account_id":"${NEAR_ACCOUNT_ID}",
        "public_key":"${NEAR_PUBLIC_KEY}",
        "private_key":"${NEAR_PRIVATE_KEY}"
      }
    EOF
    ./gradlew --no-daemon test -DincludeTags=all -Dtest.env=$INPUT_ENVIRONMENT
  env:
    NEAR_ACCOUNT_ID: ${{ inputs.NEAR_ACCOUNT_ID }}
    NEAR_PUBLIC_KEY: ${{ inputs.NEAR_PUBLIC_KEY }}
    NEAR_PRIVATE_KEY: ${{ inputs.NEAR_PRIVATE_KEY }}
